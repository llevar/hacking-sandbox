import datetime
from ib_insync import *
import time
import asyncio
import pandas as pd
import random
import numpy as np

ib = IB()
ib.connect('127.0.0.1', 4002, clientId=int(random.random()*100))

cons = b'\x84\xa3typ\xadblock_manager\xa5klass\xa9DataFrame\xa4axes\x92\x86\xa3typ\xa5index\xa5klass\xa5Index\xa4name\xc0\xa5dtype\xa6object\xa4data\xdc\x00\x13\xa5index\xa7secType\xa5conId\xa6symbol\xbclastTradeDateOrContractMonth\xa6strike\xa5right\xaamultiplier\xa8exchange\xafprimaryExchange\xa8currency\xablocalSymbol\xactradingClass\xaeincludeExpired\xa9secIdType\xa5secId\xb0comboLegsDescrip\xa9comboLegs\xa9underComp\xa8compress\xc0\x86\xa3typ\xabrange_index\xa5klass\xaaRangeIndex\xa4name\xc0\xa5start\x00\xa4stopd\xa4step\x01\xa6blocks\x94\x86\xa4locs\x86\xa3typ\xa7ndarray\xa5shape\x91\x01\xa4ndim\x01\xa5dtype\xa5int64\xa4data\xd7\x00\x05\x00\x00\x00\x00\x00\x00\x00\xa8compress\xc0\xa6values\xc8\x03 \x00\x00\x00\x00\x00\x00\x00Y@\x00\x00\x00\x00\x00@Z@\x00\x00\x00\x00\x00\x80[@\x00\x00\x00\x00\x00\xc0\\@\x00\x00\x00\x00\x00\x00^@\x00\x00\x00\x00\x00@_@\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\xe0`@\x00\x00\x00\x00\x00\x80a@\x00\x00\x00\x00\x00 b@\x00\x00\x00\x00\x00\xc0b@\x00\x00\x00\x00\x00`c@\x00\x00\x00\x00\x00\x00d@\x00\x00\x00\x00\x00\xa0d@\x00\x00\x00\x00\x00@e@\x00\x00\x00\x00\x00\xe0e@\x00\x00\x00\x00\x00\x80f@\x00\x00\x00\x00\x00 g@\x00\x00\x00\x00\x00\xc0g@\x00\x00\x00\x00\x00`h@\x00\x00\x00\x00\x00\x00i@\x00\x00\x00\x00\x00\xa0i@\x00\x00\x00\x00\x00@j@\x00\x00\x00\x00\x00\xe0j@\x00\x00\x00\x00\x00\x80k@\x00\x00\x00\x00\x00 l@\x00\x00\x00\x00\x00\xc0l@\x00\x00\x00\x00\x00`m@\x00\x00\x00\x00\x00\x00n@\x00\x00\x00\x00\x00\xa0n@\x00\x00\x00\x00\x00@o@\x00\x00\x00\x00\x00\xe0o@\x00\x00\x00\x00\x00@p@\x00\x00\x00\x00\x00\x90p@\x00\x00\x00\x00\x00\xe0p@\x00\x00\x00\x00\x000q@\x00\x00\x00\x00\x00\x80q@\x00\x00\x00\x00\x00\xd0q@\x00\x00\x00\x00\x00 r@\x00\x00\x00\x00\x00pr@\x00\x00\x00\x00\x00\xc0r@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x80K@\x00\x00\x00\x00\x00\x00N@\x00\x00\x00\x00\x00@P@\x00\x00\x00\x00\x00\x80Q@\x00\x00\x00\x00\x00\xc0R@\x00\x00\x00\x00\x00\x00T@\x00\x00\x00\x00\x00@U@\x00\x00\x00\x00\x00\x80V@\x00\x00\x00\x00\x00\xc0W@\x00\x00\x00\x00\x00\x00Y@\x00\x00\x00\x00\x00@Z@\x00\x00\x00\x00\x00\x80[@\x00\x00\x00\x00\x00\xc0\\@\x00\x00\x00\x00\x00\x00^@\x00\x00\x00\x00\x00@_@\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\xe0`@\x00\x00\x00\x00\x00\x80a@\x00\x00\x00\x00\x00 b@\x00\x00\x00\x00\x00\xc0b@\x00\x00\x00\x00\x00`c@\x00\x00\x00\x00\x00\x00d@\x00\x00\x00\x00\x00\xa0d@\x00\x00\x00\x00\x00@e@\x00\x00\x00\x00\x00\xe0e@\x00\x00\x00\x00\x00\x80f@\x00\x00\x00\x00\x00 g@\x00\x00\x00\x00\x00\xc0g@\x00\x00\x00\x00\x00`h@\x00\x00\x00\x00\x00\x00i@\x00\x00\x00\x00\x00\xa0i@\x00\x00\x00\x00\x00@j@\x00\x00\x00\x00\x00\xe0j@\x00\x00\x00\x00\x00\x80k@\x00\x00\x00\x00\x00 l@\x00\x00\x00\x00\x00\xc0l@\x00\x00\x00\x00\x00`m@\x00\x00\x00\x00\x00\x00n@\x00\x00\x00\x00\x00\xa0n@\x00\x00\x00\x00\x00@o@\x00\x00\x00\x00\x00\xe0o@\x00\x00\x00\x00\x00@p@\x00\x00\x00\x00\x00\x90p@\x00\x00\x00\x00\x00\xe0p@\x00\x00\x00\x00\x000q@\x00\x00\x00\x00\x00\x80q@\x00\x00\x00\x00\x00\xd0q@\x00\x00\x00\x00\x00 r@\x00\x00\x00\x00\x00pr@\x00\x00\x00\x00\x00\xc0r@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x80K@\x00\x00\x00\x00\x00\x00N@\x00\x00\x00\x00\x00@P@\x00\x00\x00\x00\x00\x80Q@\x00\x00\x00\x00\x00\xc0R@\x00\x00\x00\x00\x00\x00T@\x00\x00\x00\x00\x00@U@\xa5shape\x92\x01d\xa5dtype\xa7float64\xa5klass\xaaFloatBlock\xa8compress\xc0\x86\xa4locs\x86\xa3typ\xa7ndarray\xa5shape\x91\x02\xa4ndim\x01\xa5dtype\xa5int64\xa4data\xd8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\xa8compress\xc0\xa6values\xc8\x06@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\t\x00\x00\x00\x00\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x00\x00\x00\x00\x00\x00\r\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x10\x00\x00\x00\x00\x00\x00\x00\x11\x00\x00\x00\x00\x00\x00\x00\x12\x00\x00\x00\x00\x00\x00\x00\x13\x00\x00\x00\x00\x00\x00\x00\x14\x00\x00\x00\x00\x00\x00\x00\x15\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00\x00\x00\x00\x00\x17\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\x1a\x00\x00\x00\x00\x00\x00\x00\x1b\x00\x00\x00\x00\x00\x00\x00\x1c\x00\x00\x00\x00\x00\x00\x00\x1d\x00\x00\x00\x00\x00\x00\x00\x1e\x00\x00\x00\x00\x00\x00\x00\x1f\x00\x00\x00\x00\x00\x00\x00 \x00\x00\x00\x00\x00\x00\x00!\x00\x00\x00\x00\x00\x00\x00"\x00\x00\x00\x00\x00\x00\x00#\x00\x00\x00\x00\x00\x00\x00$\x00\x00\x00\x00\x00\x00\x00%\x00\x00\x00\x00\x00\x00\x00&\x00\x00\x00\x00\x00\x00\x00\'\x00\x00\x00\x00\x00\x00\x00(\x00\x00\x00\x00\x00\x00\x00)\x00\x00\x00\x00\x00\x00\x00*\x00\x00\x00\x00\x00\x00\x00+\x00\x00\x00\x00\x00\x00\x00,\x00\x00\x00\x00\x00\x00\x00-\x00\x00\x00\x00\x00\x00\x00.\x00\x00\x00\x00\x00\x00\x00/\x00\x00\x00\x00\x00\x00\x000\x00\x00\x00\x00\x00\x00\x001\x00\x00\x00\x00\x00\x00\x002\x00\x00\x00\x00\x00\x00\x003\x00\x00\x00\x00\x00\x00\x004\x00\x00\x00\x00\x00\x00\x005\x00\x00\x00\x00\x00\x00\x006\x00\x00\x00\x00\x00\x00\x007\x00\x00\x00\x00\x00\x00\x008\x00\x00\x00\x00\x00\x00\x009\x00\x00\x00\x00\x00\x00\x00:\x00\x00\x00\x00\x00\x00\x00;\x00\x00\x00\x00\x00\x00\x00<\x00\x00\x00\x00\x00\x00\x00=\x00\x00\x00\x00\x00\x00\x00>\x00\x00\x00\x00\x00\x00\x00?\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x00A\x00\x00\x00\x00\x00\x00\x00B\x00\x00\x00\x00\x00\x00\x00C\x00\x00\x00\x00\x00\x00\x00D\x00\x00\x00\x00\x00\x00\x00E\x00\x00\x00\x00\x00\x00\x00F\x00\x00\x00\x00\x00\x00\x00G\x00\x00\x00\x00\x00\x00\x00H\x00\x00\x00\x00\x00\x00\x00I\x00\x00\x00\x00\x00\x00\x00J\x00\x00\x00\x00\x00\x00\x00K\x00\x00\x00\x00\x00\x00\x00L\x00\x00\x00\x00\x00\x00\x00M\x00\x00\x00\x00\x00\x00\x00N\x00\x00\x00\x00\x00\x00\x00O\x00\x00\x00\x00\x00\x00\x00P\x00\x00\x00\x00\x00\x00\x00Q\x00\x00\x00\x00\x00\x00\x00R\x00\x00\x00\x00\x00\x00\x00S\x00\x00\x00\x00\x00\x00\x00T\x00\x00\x00\x00\x00\x00\x00U\x00\x00\x00\x00\x00\x00\x00V\x00\x00\x00\x00\x00\x00\x00W\x00\x00\x00\x00\x00\x00\x00X\x00\x00\x00\x00\x00\x00\x00Y\x00\x00\x00\x00\x00\x00\x00Z\x00\x00\x00\x00\x00\x00\x00[\x00\x00\x00\x00\x00\x00\x00\\\x00\x00\x00\x00\x00\x00\x00]\x00\x00\x00\x00\x00\x00\x00^\x00\x00\x00\x00\x00\x00\x00_\x00\x00\x00\x00\x00\x00\x00`\x00\x00\x00\x00\x00\x00\x00a\x00\x00\x00\x00\x00\x00\x00b\x00\x00\x00\x00\x00\x00\x00c\x00\x00\x00\x00\x00\x00\x00k\xad\xf3\x0c\x00\x00\x00\x00n\xad\xf3\x0c\x00\x00\x00\x00p\xad\xf3\x0c\x00\x00\x00\x00u\xad\xf3\x0c\x00\x00\x00\x00z\xad\xf3\x0c\x00\x00\x00\x00\x7f\xad\xf3\x0c\x00\x00\x00\x00\x80\xad\xf3\x0c\x00\x00\x00\x00\x85\xad\xf3\x0c\x00\x00\x00\x00\x8a\xad\xf3\x0c\x00\x00\x00\x00\x8f\xad\xf3\x0c\x00\x00\x00\x00\x91\xad\xf3\x0c\x00\x00\x00\x00\x94\xad\xf3\x0c\x00\x00\x00\x00\x9b\xad\xf3\x0c\x00\x00\x00\x00\x9e\xad\xf3\x0c\x00\x00\x00\x00\xa2\xad\xf3\x0c\x00\x00\x00\x00\xa7\xad\xf3\x0c\x00\x00\x00\x00\xa8\xad\xf3\x0c\x00\x00\x00\x00\xad\xad\xf3\x0c\x00\x00\x00\x00\xb3\xad\xf3\x0c\x00\x00\x00\x00\xb6\xad\xf3\x0c\x00\x00\x00\x00\xb9\xad\xf3\x0c\x00\x00\x00\x00\xbc\xad\xf3\x0c\x00\x00\x00\x00\xc1\xad\xf3\x0c\x00\x00\x00\x00\xc4\xad\xf3\x0c\x00\x00\x00\x00\xcb\xad\xf3\x0c\x00\x00\x00\x00\xce\xad\xf3\x0c\x00\x00\x00\x00\xd0\xad\xf3\x0c\x00\x00\x00\x00\xd5\xad\xf3\x0c\x00\x00\x00\x00\xda\xad\xf3\x0c\x00\x00\x00\x00\xdf\xad\xf3\x0c\x00\x00\x00\x00\xe3\xad\xf3\x0c\x00\x00\x00\x00\xe6\xad\xf3\x0c\x00\x00\x00\x00\xe9\xad\xf3\x0c\x00\x00\x00\x00\xec\xad\xf3\x0c\x00\x00\x00\x00\xf2\xad\xf3\x0c\x00\x00\x00\x00\xf7\xad\xf3\x0c\x00\x00\x00\x00\xf8\xad\xf3\x0c\x00\x00\x00\x00\xfd\xad\xf3\x0c\x00\x00\x00\x00\x01\xae\xf3\x0c\x00\x00\x00\x00\x04\xae\xf3\x0c\x00\x00\x00\x00\x0b\xae\xf3\x0c\x00\x00\x00\x00\x0e\xae\xf3\x0c\x00\x00\x00\x00\x10\xae\xf3\x0c\x00\x00\x00\x00\x15\xae\xf3\x0c\x00\x00\x00\x00\x1a\xae\xf3\x0c\x00\x00\x00\x00\x1f\xae\xf3\x0c\x00\x00\x00\x00#\xae\xf3\x0c\x00\x00\x00\x00&\xae\xf3\x0c\x00\x00\x00\x00)\xae\xf3\x0c\x00\x00\x00\x00,\xae\xf3\x0c\x00\x00\x00\x002\xae\xf3\x0c\x00\x00\x00\x007\xae\xf3\x0c\x00\x00\x00\x008\xae\xf3\x0c\x00\x00\x00\x00=\xae\xf3\x0c\x00\x00\x00\x00@\xae\xf3\x0c\x00\x00\x00\x00E\xae\xf3\x0c\x00\x00\x00\x00J\xae\xf3\x0c\x00\x00\x00\x00O\xae\xf3\x0c\x00\x00\x00\x00Q\xae\xf3\x0c\x00\x00\x00\x00T\xae\xf3\x0c\x00\x00\x00\x00[\xae\xf3\x0c\x00\x00\x00\x00^\xae\xf3\x0c\x00\x00\x00\x00b\xae\xf3\x0c\x00\x00\x00\x00g\xae\xf3\x0c\x00\x00\x00\x00h\xae\xf3\x0c\x00\x00\x00\x00m\xae\xf3\x0c\x00\x00\x00\x00s\xae\xf3\x0c\x00\x00\x00\x00v\xae\xf3\x0c\x00\x00\x00\x00y\xae\xf3\x0c\x00\x00\x00\x00|\xae\xf3\x0c\x00\x00\x00\x00\x83\xae\xf3\x0c\x00\x00\x00\x00\x86\xae\xf3\x0c\x00\x00\x00\x00\x89\xae\xf3\x0c\x00\x00\x00\x00\x8c\xae\xf3\x0c\x00\x00\x00\x00\x92\xae\xf3\x0c\x00\x00\x00\x00\x97\xae\xf3\x0c\x00\x00\x00\x00\x98\xae\xf3\x0c\x00\x00\x00\x00\x9d\xae\xf3\x0c\x00\x00\x00\x00\xa1\xae\xf3\x0c\x00\x00\x00\x00\xa4\xae\xf3\x0c\x00\x00\x00\x00\xab\xae\xf3\x0c\x00\x00\x00\x00\xae\xae\xf3\x0c\x00\x00\x00\x00\xb0\xae\xf3\x0c\x00\x00\x00\x00\xb5\xae\xf3\x0c\x00\x00\x00\x00\xba\xae\xf3\x0c\x00\x00\x00\x00\xbf\xae\xf3\x0c\x00\x00\x00\x00\xc2\xae\xf3\x0c\x00\x00\x00\x00\xc7\xae\xf3\x0c\x00\x00\x00\x00\xc8\xae\xf3\x0c\x00\x00\x00\x00\xcd\xae\xf3\x0c\x00\x00\x00\x00\xd3\xae\xf3\x0c\x00\x00\x00\x00\xd6\xae\xf3\x0c\x00\x00\x00\x00\xd9\xae\xf3\x0c\x00\x00\x00\x00\xdc\xae\xf3\x0c\x00\x00\x00\x00\xe0\xae\xf3\x0c\x00\x00\x00\x00\xe5\xae\xf3\x0c\x00\x00\x00\x00\xea\xae\xf3\x0c\x00\x00\x00\x00\xef\xae\xf3\x0c\x00\x00\x00\x00\xf1\xae\xf3\x0c\x00\x00\x00\x00\xf4\xae\xf3\x0c\x00\x00\x00\x00\xa5shape\x92\x02d\xa5dtype\xa5int64\xa5klass\xa8IntBlock\xa8compress\xc0\x86\xa4locs\x86\xa3typ\xa7ndarray\xa5shape\x91\x01\xa4ndim\x01\xa5dtype\xa5int64\xa4data\xd7\x00\r\x00\x00\x00\x00\x00\x00\x00\xa8compress\xc0\xa6values\xc7d\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa5shape\x92\x01d\xa5dtype\xa4bool\xa5klass\xa9BoolBlock\xa8compress\xc0\x86\xa4locs\x86\xa3typ\xa7ndarray\xa5shape\x91\x0f\xa4ndim\x01\xa5dtype\xa5int64\xa4data\xc7x\x00\x01\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\t\x00\x00\x00\x00\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x10\x00\x00\x00\x00\x00\x00\x00\x11\x00\x00\x00\x00\x00\x00\x00\x12\x00\x00\x00\x00\x00\x00\x00\xa8compress\xc0\xa6values\xdc\x05\xdc\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3OPT\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa820181221\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1C\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa1P\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa3100\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa5SMART\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xa3USD\xb5SPY   181221C00100000\xb5SPY   181221C00105000\xb5SPY   181221C00110000\xb5SPY   181221C00115000\xb5SPY   181221C00120000\xb5SPY   181221C00125000\xb5SPY   181221C00130000\xb5SPY   181221C00135000\xb5SPY   181221C00140000\xb5SPY   181221C00145000\xb5SPY   181221C00150000\xb5SPY   181221C00155000\xb5SPY   181221C00160000\xb5SPY   181221C00165000\xb5SPY   181221C00170000\xb5SPY   181221C00175000\xb5SPY   181221C00180000\xb5SPY   181221C00185000\xb5SPY   181221C00190000\xb5SPY   181221C00195000\xb5SPY   181221C00200000\xb5SPY   181221C00205000\xb5SPY   181221C00210000\xb5SPY   181221C00215000\xb5SPY   181221C00220000\xb5SPY   181221C00225000\xb5SPY   181221C00230000\xb5SPY   181221C00235000\xb5SPY   181221C00240000\xb5SPY   181221C00245000\xb5SPY   181221C00250000\xb5SPY   181221C00255000\xb5SPY   181221C00260000\xb5SPY   181221C00265000\xb5SPY   181221C00270000\xb5SPY   181221C00275000\xb5SPY   181221C00280000\xb5SPY   181221C00285000\xb5SPY   181221C00290000\xb5SPY   181221C00295000\xb5SPY   181221C00300000\xb5SPY   181221C00050000\xb5SPY   181221C00055000\xb5SPY   181221C00060000\xb5SPY   181221C00065000\xb5SPY   181221C00070000\xb5SPY   181221C00075000\xb5SPY   181221C00080000\xb5SPY   181221C00085000\xb5SPY   181221C00090000\xb5SPY   181221C00095000\xb5SPY   181221P00100000\xb5SPY   181221P00105000\xb5SPY   181221P00110000\xb5SPY   181221P00115000\xb5SPY   181221P00120000\xb5SPY   181221P00125000\xb5SPY   181221P00130000\xb5SPY   181221P00135000\xb5SPY   181221P00140000\xb5SPY   181221P00145000\xb5SPY   181221P00150000\xb5SPY   181221P00155000\xb5SPY   181221P00160000\xb5SPY   181221P00165000\xb5SPY   181221P00170000\xb5SPY   181221P00175000\xb5SPY   181221P00180000\xb5SPY   181221P00185000\xb5SPY   181221P00190000\xb5SPY   181221P00195000\xb5SPY   181221P00200000\xb5SPY   181221P00205000\xb5SPY   181221P00210000\xb5SPY   181221P00215000\xb5SPY   181221P00220000\xb5SPY   181221P00225000\xb5SPY   181221P00230000\xb5SPY   181221P00235000\xb5SPY   181221P00240000\xb5SPY   181221P00245000\xb5SPY   181221P00250000\xb5SPY   181221P00255000\xb5SPY   181221P00260000\xb5SPY   181221P00265000\xb5SPY   181221P00270000\xb5SPY   181221P00275000\xb5SPY   181221P00280000\xb5SPY   181221P00285000\xb5SPY   181221P00290000\xb5SPY   181221P00295000\xb5SPY   181221P00300000\xb5SPY   181221P00050000\xb5SPY   181221P00055000\xb5SPY   181221P00060000\xb5SPY   181221P00065000\xb5SPY   181221P00070000\xb5SPY   181221P00075000\xb5SPY   181221P00080000\xb5SPY   181221P00085000\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa3SPY\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xc0\xa5shape\x92\x0fd\xa5dtype\xa6object\xa5klass\xabObjectBlock\xa8compress\xc0'
con_df = pd.read_msgpack(cons)

sync_stamps = b'\x84\xa3typ\xadblock_manager\xa5klass\xa9DataFrame\xa4axes\x92\x86\xa3typ\xa5index\xa5klass\xa5Index\xa4name\xc0\xa5dtype\xa6object\xa4data\x91\xaetimestamp_sync\xa8compress\xc0\x86\xa3typ\xa5index\xa5klass\xaaInt64Index\xa4name\xabcontract_id\xa5dtype\xa5int64\xa4data\xc8\x03 \x00k\xad\xf3\x0c\x00\x00\x00\x00n\xad\xf3\x0c\x00\x00\x00\x00p\xad\xf3\x0c\x00\x00\x00\x00u\xad\xf3\x0c\x00\x00\x00\x00z\xad\xf3\x0c\x00\x00\x00\x00\x7f\xad\xf3\x0c\x00\x00\x00\x00\x80\xad\xf3\x0c\x00\x00\x00\x00\x85\xad\xf3\x0c\x00\x00\x00\x00\x8a\xad\xf3\x0c\x00\x00\x00\x00\x8f\xad\xf3\x0c\x00\x00\x00\x00\x91\xad\xf3\x0c\x00\x00\x00\x00\x94\xad\xf3\x0c\x00\x00\x00\x00\x9b\xad\xf3\x0c\x00\x00\x00\x00\x9e\xad\xf3\x0c\x00\x00\x00\x00\xa2\xad\xf3\x0c\x00\x00\x00\x00\xa7\xad\xf3\x0c\x00\x00\x00\x00\xa8\xad\xf3\x0c\x00\x00\x00\x00\xad\xad\xf3\x0c\x00\x00\x00\x00\xb3\xad\xf3\x0c\x00\x00\x00\x00\xb6\xad\xf3\x0c\x00\x00\x00\x00\xb9\xad\xf3\x0c\x00\x00\x00\x00\xbc\xad\xf3\x0c\x00\x00\x00\x00\xc1\xad\xf3\x0c\x00\x00\x00\x00\xc4\xad\xf3\x0c\x00\x00\x00\x00\xcb\xad\xf3\x0c\x00\x00\x00\x00\xce\xad\xf3\x0c\x00\x00\x00\x00\xd0\xad\xf3\x0c\x00\x00\x00\x00\xd5\xad\xf3\x0c\x00\x00\x00\x00\xda\xad\xf3\x0c\x00\x00\x00\x00\xdf\xad\xf3\x0c\x00\x00\x00\x00\xe3\xad\xf3\x0c\x00\x00\x00\x00\xe6\xad\xf3\x0c\x00\x00\x00\x00\xe9\xad\xf3\x0c\x00\x00\x00\x00\xec\xad\xf3\x0c\x00\x00\x00\x00\xf2\xad\xf3\x0c\x00\x00\x00\x00\xf7\xad\xf3\x0c\x00\x00\x00\x00\xf8\xad\xf3\x0c\x00\x00\x00\x00\xfd\xad\xf3\x0c\x00\x00\x00\x00\x01\xae\xf3\x0c\x00\x00\x00\x00\x04\xae\xf3\x0c\x00\x00\x00\x00\x0b\xae\xf3\x0c\x00\x00\x00\x00\x0e\xae\xf3\x0c\x00\x00\x00\x00\x10\xae\xf3\x0c\x00\x00\x00\x00\x15\xae\xf3\x0c\x00\x00\x00\x00\x1a\xae\xf3\x0c\x00\x00\x00\x00\x1f\xae\xf3\x0c\x00\x00\x00\x00#\xae\xf3\x0c\x00\x00\x00\x00&\xae\xf3\x0c\x00\x00\x00\x00)\xae\xf3\x0c\x00\x00\x00\x00,\xae\xf3\x0c\x00\x00\x00\x002\xae\xf3\x0c\x00\x00\x00\x007\xae\xf3\x0c\x00\x00\x00\x008\xae\xf3\x0c\x00\x00\x00\x00=\xae\xf3\x0c\x00\x00\x00\x00@\xae\xf3\x0c\x00\x00\x00\x00E\xae\xf3\x0c\x00\x00\x00\x00J\xae\xf3\x0c\x00\x00\x00\x00O\xae\xf3\x0c\x00\x00\x00\x00Q\xae\xf3\x0c\x00\x00\x00\x00T\xae\xf3\x0c\x00\x00\x00\x00[\xae\xf3\x0c\x00\x00\x00\x00^\xae\xf3\x0c\x00\x00\x00\x00b\xae\xf3\x0c\x00\x00\x00\x00g\xae\xf3\x0c\x00\x00\x00\x00h\xae\xf3\x0c\x00\x00\x00\x00m\xae\xf3\x0c\x00\x00\x00\x00s\xae\xf3\x0c\x00\x00\x00\x00v\xae\xf3\x0c\x00\x00\x00\x00y\xae\xf3\x0c\x00\x00\x00\x00|\xae\xf3\x0c\x00\x00\x00\x00\x83\xae\xf3\x0c\x00\x00\x00\x00\x86\xae\xf3\x0c\x00\x00\x00\x00\x89\xae\xf3\x0c\x00\x00\x00\x00\x8c\xae\xf3\x0c\x00\x00\x00\x00\x92\xae\xf3\x0c\x00\x00\x00\x00\x97\xae\xf3\x0c\x00\x00\x00\x00\x98\xae\xf3\x0c\x00\x00\x00\x00\x9d\xae\xf3\x0c\x00\x00\x00\x00\xa1\xae\xf3\x0c\x00\x00\x00\x00\xa4\xae\xf3\x0c\x00\x00\x00\x00\xab\xae\xf3\x0c\x00\x00\x00\x00\xae\xae\xf3\x0c\x00\x00\x00\x00\xb0\xae\xf3\x0c\x00\x00\x00\x00\xb5\xae\xf3\x0c\x00\x00\x00\x00\xba\xae\xf3\x0c\x00\x00\x00\x00\xbf\xae\xf3\x0c\x00\x00\x00\x00\xc2\xae\xf3\x0c\x00\x00\x00\x00\xc7\xae\xf3\x0c\x00\x00\x00\x00\xc8\xae\xf3\x0c\x00\x00\x00\x00\xcd\xae\xf3\x0c\x00\x00\x00\x00\xd3\xae\xf3\x0c\x00\x00\x00\x00\xd6\xae\xf3\x0c\x00\x00\x00\x00\xd9\xae\xf3\x0c\x00\x00\x00\x00\xdc\xae\xf3\x0c\x00\x00\x00\x00\xe0\xae\xf3\x0c\x00\x00\x00\x00\xe5\xae\xf3\x0c\x00\x00\x00\x00\xea\xae\xf3\x0c\x00\x00\x00\x00\xef\xae\xf3\x0c\x00\x00\x00\x00\xf1\xae\xf3\x0c\x00\x00\x00\x00\xf4\xae\xf3\x0c\x00\x00\x00\x00\xa8compress\xc0\xa6blocks\x91\x86\xa4locs\x86\xa3typ\xa7ndarray\xa5shape\x91\x01\xa4ndim\x01\xa5dtype\xa5int64\xa4data\xd7\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa8compress\xc0\xa6values\xc8\x03 \x00\x00\xe4\xf1\xb8d\xb4\x15\x15\x00@U\xa6\n\x178\x15\x00\x94\x9d\xc4\xfd%\x1c\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x0c\xbe(z\x8f\x1b\x15\x00\xac\x97\xc0F)\x1c\x15\x00h\xebd&o\x15\x15\x00"\xc4Lg\x8f\x1b\x15\x00\xe4\x85\xee\xdb\xb4\x15\x15\x00\\\xe8V\xca\x0f\x16\x15\x00\x16p\xae\x9b\xf3!\x15\x00\x86\x11F\x0f\xd0#\x15\x00\xbe\xb7\x00\xe9\x8f\x1e\x15\x00\xfc\xf1\x8d>\x87\x17\x15\x00 \x1e\xdf\xcef\x15\x15\x00\x8cA\xdf\x17\xe7\x16\x15\x00z\xcb1\xe4\xb5\x15\x15\x00\xach\x97\xd2\xeb\x16\x15\x00\x8ed\x1f\xcd\xea\x16\x15\x00|A`(G\x17\x15\x00X\xdb\x03\x00\xb7\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00r:\xed\x9cg\x15\x15\x00\xbe\xfa?\xaf\x85\x17\x15\x00\x12\xd3\x1c\x13\x0b\x16\x15\x00\x16r\xc4\xf0\xb5\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\xfc\xc7O\xe6\xad\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00&7\xc9\x11p\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00j$\xab\xff_\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x12>s\xeb\xfd\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x92\xcf\xd4\xfc\'\x1c\x15\x00\xc8&\x9f&)\x1c\x15\x00\x90{\xa9Z(\x1c\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00D\xf1\x8c\xa4\xb0\x19\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\xc8\xb1r\x16n\x15\x15\x00\x0e\x99}2\xfc\x19\x15\x00\xfa\x00\xdc\x8e\xe5\x17\x15\x00\xd2\x82k\xe6\x0c\x19\x15\x00\x10{\xddO>\x17\x15\x000@\x90\xc8\xf1\x16\x15\x00B\xd0\x86\xa96\x17\x15\x00\x9e\xd6\x855\xf4\x16\x15\x00\xde\xf3\xcd[\xd2\x17\x15\x00j\x0e\xa5\xdbr\x15\x15\x00\x86\x02Q\xd9r\x15\x15\x00(\x9f\xf6\x82\x97\x17\x15\x006#\xbes\xb3\x15\x15\x00\xf4\x05 \xb2c\x15\x15\x00F\xe0Qya\x15\x15\x00\x84!\xb7\xc5\xad\x15\x15\x00\x14^\xe4\xc7\xe7\x16\x15\x00\xce\x1d\xc5\xacc\x15\x15\x00\xc4tr\xaaa\x15\x15\x00\xb0\xbf\xe0\xeb\x0b\x16\x15\x00x:u\xaa]\x15\x15\x00\xb6(C;d\x15\x15\x00\x1e\x1f\x04\xe1l\x15\x15\x00\x10v\x13\xa2]\x15\x15\x00*\xe7+\xa4]\x15\x15\x00\x10\x84<\xe0\xb5\x15\x15\x00\xd0\xb5O\xe9a\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x06tj\xc4^\x15\x15\x00\x0er\xedD\xb9\x15\x15\x00\xfa\x08\x9f\x03b\x15\x15\x00\xfa\x08\x9f\x03b\x15\x15\x00R\x07\xf4\x04$\x15\x15\x00\x80e\xae\x88c\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00D\x88 \xb0j\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\xfa\x1b\x13\xb1d\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x80\x00\x14\xbc\x93\x0ce\x15\x15\x00\x00\x00\x00\x00\x00\x00\x80\x00\x90\x9c!\xd2\xd8#\x15\x00\x92\x9c\x83\xe4\x8c&\x15\x00D>=:\x1e7\x15\x00\xdc7\x8f\xf5\x9d"\x15\x00J\n\xff\xa5\xee\x16\x15\x00\x90{\xa9Z(\x1c\x15\x00Z*&\x0f\x13\x19\x15\xa5shape\x91d\xa5dtype\xb3datetime64[ns, UTC]\xa5klass\xafDatetimeTZBlock\xa8compress\xc0'
typical_sync_runtime = 141

#print(sync_stamps == sync_stamps_2)

run_sync = False
compare_with_stored = True

sema = asyncio.Semaphore(50)

async def get_timestamp_async(contract):
    my_con = Option(conId=contract.conId, exchange=contract.exchange)
    try:
        async with sema:
            first_date = await ib.reqHeadTimeStampAsync(my_con, "TRADES", False,2)
            print("Completed {}".format(contract.conId))
    except ValueError:
        first_date = None
    
    if not isinstance(first_date, datetime.datetime):
        first_date = None
        
    return (contract.conId, first_date)   

def get_timestamp(contract):
    my_con = Option(conId=contract.conId, exchange=contract.exchange)
    try:
        first_date = ib.reqHeadTimeStamp(my_con, "TRADES", False,2)
        print("Completed {}".format(contract.conId))
    except ValueError:
        first_date = None
    
    if not isinstance(first_date, datetime.datetime):
        first_date = None
        
    return (contract.conId, first_date)   

async def main():
    tasks = [asyncio.ensure_future(get_timestamp_async(row)) for index,row in con_df.iterrows()]
    return await asyncio.gather(*tasks)
    

if __name__ == '__main__':
    start_time = time.time()
    async_results = IB.run(main())
    a = pd.DataFrame(async_results,columns=['contract_id','timestamp_async']).set_index('contract_id')
    print("Async execution time was: {}".format(str(time.time() - start_time)))
    
    if run_sync:
        start_time = time.time()
        sync_results = [get_timestamp(row) for index,row in con_df.iterrows()]
        s = pd.DataFrame(sync_results,columns=['contract_id','timestamp_sync']).set_index('contract_id')
        print("Sync execution time was: {}".format(str(time.time() - start_time)))
        
        if compare_with_stored:
            stored_s = pd.read_msgpack(sync_stamps)
            print("Comparing stored to downloaded sync data: {}".format(s.equals(stored_s)))
    else:
        s = pd.read_msgpack(sync_stamps)
        
    joined = pd.concat([a,s],axis=1)
    print(joined)
    print(joined['timestamp_sync'].equals(joined['timestamp_async']))
    